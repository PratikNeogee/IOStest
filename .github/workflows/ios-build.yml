name: iOS Build Test

on:
  push:
    branches: [ main ]
    paths:
      - 'mock-ios-project/**'
      - '.github/workflows/ios-build.yml'
  workflow_dispatch:  # Allow manual trigger

jobs:
  build-ios:
    name: Build iOS App
    runs-on: macos-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: 'latest-stable'
    
    - name: Create Xcode Project
      run: |
        cd mock-ios-project
        echo "🏗️ Creating Xcode project structure..."
        
        # Create the basic project structure
        mkdir -p MockApp.xcodeproj
        
        # Create a basic project.pbxproj file
        cat > MockApp.xcodeproj/project.pbxproj << 'EOF'
        // !$*UTF8*$!
        {
        	archiveVersion = 1;
        	classes = {
        	};
        	objectVersion = 56;
        	objects = {
        		048A1A9F2A5E4F2D004B1234 /* MockApp */ = {
        			isa = PBXGroup;
        			children = (
        				048A1AA02A5E4F2D004B1234 /* AppDelegate.swift */,
        				048A1AA12A5E4F2D004B1234 /* Info.plist */,
        			);
        			path = MockApp;
        			sourceTree = "<group>";
        		};
        		048A1AA02A5E4F2D004B1234 /* AppDelegate.swift */ = {
        			isa = PBXFileReference;
        			lastKnownFileType = sourcecode.swift;
        			path = AppDelegate.swift;
        			sourceTree = "<group>";
        		};
        		048A1AA12A5E4F2D004B1234 /* Info.plist */ = {
        			isa = PBXFileReference;
        			lastKnownFileType = text.plist.xml;
        			path = Info.plist;
        			sourceTree = "<group>";
        		};
        		048A1AA22A5E4F2D004B1234 /* MockApp.app */ = {
        			isa = PBXFileReference;
        			explicitFileType = wrapper.application;
        			includeInIndex = 0;
        			path = MockApp.app;
        			sourceTree = BUILT_PRODUCTS_DIR;
        		};
        		048A1AA32A5E4F2D004B1234 /* Products */ = {
        			isa = PBXGroup;
        			children = (
        				048A1AA22A5E4F2D004B1234 /* MockApp.app */,
        			);
        			name = Products;
        			sourceTree = "<group>";
        		};
        		048A1AA42A5E4F2D004B1234 /* MockAppTarget */ = {
        			isa = PBXNativeTarget;
        			buildConfigurationList = 048A1AA52A5E4F2D004B1234;
        			buildPhases = (
        				048A1AA62A5E4F2D004B1234,
        				048A1AA72A5E4F2D004B1234,
        			);
        			buildRules = (
        			);
        			dependencies = (
        			);
        			name = MockApp;
        			productName = MockApp;
        			productReference = 048A1AA22A5E4F2D004B1234;
        			productType = "com.apple.product-type.application";
        		};
        		048A1AA52A5E4F2D004B1234 /* Build configuration list for PBXNativeTarget "MockApp" */ = {
        			isa = XCConfigurationList;
        			buildConfigurations = (
        				048A1AA82A5E4F2D004B1234,
        				048A1AA92A5E4F2D004B1234,
        			);
        			defaultConfigurationIsVisible = 0;
        			defaultConfigurationName = Release;
        		};
        		048A1AA62A5E4F2D004B1234 /* Sources */ = {
        			isa = PBXSourcesBuildPhase;
        			buildActionMask = 2147483647;
        			files = (
        				048A1AAA2A5E4F2D004B1234,
        			);
        			runOnlyForDeploymentPostprocessing = 0;
        		};
        		048A1AA72A5E4F2D004B1234 /* Resources */ = {
        			isa = PBXResourcesBuildPhase;
        			buildActionMask = 2147483647;
        			files = (
        			);
        			runOnlyForDeploymentPostprocessing = 0;
        		};
        		048A1AA82A5E4F2D004B1234 /* Debug */ = {
        			isa = XCBuildConfiguration;
        			buildSettings = {
        				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
        				CODE_SIGN_IDENTITY = "iPhone Developer";
        				CODE_SIGN_STYLE = Automatic;
        				DEVELOPMENT_TEAM = "";
        				INFOPLIST_FILE = MockApp/Info.plist;
        				IPHONEOS_DEPLOYMENT_TARGET = 14.0;
        				PRODUCT_BUNDLE_IDENTIFIER = com.test.mockapp;
        				PRODUCT_NAME = MockApp;
        				SWIFT_VERSION = 5.0;
        				TARGETED_DEVICE_FAMILY = 1;
        			};
        			name = Debug;
        		};
        		048A1AA92A5E4F2D004B1234 /* Release */ = {
        			isa = XCBuildConfiguration;
        			buildSettings = {
        				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
        				CODE_SIGN_IDENTITY = "iPhone Developer";
        				CODE_SIGN_STYLE = Automatic;
        				DEVELOPMENT_TEAM = "";
        				INFOPLIST_FILE = MockApp/Info.plist;
        				IPHONEOS_DEPLOYMENT_TARGET = 14.0;
        				PRODUCT_BUNDLE_IDENTIFIER = com.test.mockapp;
        				PRODUCT_NAME = MockApp;
        				SWIFT_VERSION = 5.0;
        				TARGETED_DEVICE_FAMILY = 1;
        			};
        			name = Release;
        		};
        		048A1AAA2A5E4F2D004B1234 /* AppDelegate.swift in Sources */ = {
        			isa = PBXBuildFile;
        			fileRef = 048A1AA02A5E4F2D004B1234;
        		};
        		048A1AAB2A5E4F2D004B1234 /* Project object */ = {
        			isa = PBXProject;
        			attributes = {
        				LastSwiftUpdateCheck = 1430;
        				LastUpgradeCheck = 1430;
        				TargetAttributes = {
        					048A1AA42A5E4F2D004B1234 = {
        						CreatedOnToolsVersion = 14.3;
        					};
        				};
        			};
        			buildConfigurationList = 048A1AAC2A5E4F2D004B1234;
        			compatibilityVersion = "Xcode 14.0";
        			developmentRegion = en;
        			hasScannedForEncodings = 0;
        			knownRegions = (
        				en,
        			);
        			mainGroup = 048A1AAD2A5E4F2D004B1234;
        			productRefGroup = 048A1AA32A5E4F2D004B1234;
        			projectDirPath = "";
        			projectRoot = "";
        			targets = (
        				048A1AA42A5E4F2D004B1234,
        			);
        		};
        		048A1AAC2A5E4F2D004B1234 /* Build configuration list for PBXProject "MockApp" */ = {
        			isa = XCConfigurationList;
        			buildConfigurations = (
        				048A1AAE2A5E4F2D004B1234,
        				048A1AAF2A5E4F2D004B1234,
        			);
        			defaultConfigurationIsVisible = 0;
        			defaultConfigurationName = Release;
        		};
        		048A1AAD2A5E4F2D004B1234 /* MockApp */ = {
        			isa = PBXGroup;
        			children = (
        				048A1A9F2A5E4F2D004B1234,
        				048A1AA32A5E4F2D004B1234,
        			);
        			sourceTree = "<group>";
        		};
        		048A1AAE2A5E4F2D004B1234 /* Debug */ = {
        			isa = XCBuildConfiguration;
        			buildSettings = {
        				ALWAYS_SEARCH_USER_PATHS = NO;
        				CLANG_ANALYZER_NONNULL = YES;
        				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
        				CLANG_CXX_LANGUAGE_STANDARD = "gnu++20";
        				CLANG_ENABLE_MODULES = YES;
        				CLANG_ENABLE_OBJC_ARC = YES;
        				CLANG_ENABLE_OBJC_WEAK = YES;
        				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
        				CLANG_WARN_BOOL_CONVERSION = YES;
        				CLANG_WARN_COMMA = YES;
        				CLANG_WARN_CONSTANT_CONVERSION = YES;
        				CLANG_WARN_DEPRECATED_OBJC_IMPLEMENTATIONS = YES;
        				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
        				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
        				CLANG_WARN_EMPTY_BODY = YES;
        				CLANG_WARN_ENUM_CONVERSION = YES;
        				CLANG_WARN_INFINITE_RECURSION = YES;
        				CLANG_WARN_INT_CONVERSION = YES;
        				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
        				CLANG_WARN_OBJC_IMPLICIT_RETAIN_SELF = YES;
        				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
        				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
        				CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER = YES;
        				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
        				CLANG_WARN_STRICT_PROTOTYPES = YES;
        				CLANG_WARN_SUSPICIOUS_MOVE = YES;
        				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
        				CLANG_WARN_UNREACHABLE_CODE = YES;
        				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
        				COPY_PHASE_STRIP = NO;
        				DEBUG_INFORMATION_FORMAT = dwarf;
        				ENABLE_STRICT_OBJC_MSGSEND = YES;
        				ENABLE_TESTABILITY = YES;
        				GCC_C_LANGUAGE_STANDARD = gnu11;
        				GCC_DYNAMIC_NO_PIC = NO;
        				GCC_NO_COMMON_BLOCKS = YES;
        				GCC_OPTIMIZATION_LEVEL = 0;
        				GCC_PREPROCESSOR_DEFINITIONS = (
        					"DEBUG=1",
        					"$(inherited)",
        				);
        				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
        				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
        				GCC_WARN_UNDECLARED_SELECTOR = YES;
        				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
        				GCC_WARN_UNUSED_FUNCTION = YES;
        				GCC_WARN_UNUSED_VARIABLE = YES;
        				IPHONEOS_DEPLOYMENT_TARGET = 14.0;
        				MTL_ENABLE_DEBUG_INFO = INCLUDE_SOURCE;
        				MTL_FAST_MATH = YES;
        				ONLY_ACTIVE_ARCH = YES;
        				SDKROOT = iphoneos;
        				SWIFT_ACTIVE_COMPILATION_CONDITIONS = DEBUG;
        				SWIFT_OPTIMIZATION_LEVEL = "-Onone";
        			};
        			name = Debug;
        		};
        		048A1AAF2A5E4F2D004B1234 /* Release */ = {
        			isa = XCBuildConfiguration;
        			buildSettings = {
        				ALWAYS_SEARCH_USER_PATHS = NO;
        				CLANG_ANALYZER_NONNULL = YES;
        				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
        				CLANG_CXX_LANGUAGE_STANDARD = "gnu++20";
        				CLANG_ENABLE_MODULES = YES;
        				CLANG_ENABLE_OBJC_ARC = YES;
        				CLANG_ENABLE_OBJC_WEAK = YES;
        				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
        				CLANG_WARN_BOOL_CONVERSION = YES;
        				CLANG_WARN_COMMA = YES;
        				CLANG_WARN_CONSTANT_CONVERSION = YES;
        				CLANG_WARN_DEPRECATED_OBJC_IMPLEMENTATIONS = YES;
        				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
        				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
        				CLANG_WARN_EMPTY_BODY = YES;
        				CLANG_WARN_ENUM_CONVERSION = YES;
        				CLANG_WARN_INFINITE_RECURSION = YES;
        				CLANG_WARN_INT_CONVERSION = YES;
        				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
        				CLANG_WARN_OBJC_IMPLICIT_RETAIN_SELF = YES;
        				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
        				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
        				CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER = YES;
        				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
        				CLANG_WARN_STRICT_PROTOTYPES = YES;
        				CLANG_WARN_SUSPICIOUS_MOVE = YES;
        				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
        				CLANG_WARN_UNREACHABLE_CODE = YES;
        				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
        				COPY_PHASE_STRIP = NO;
        				DEBUG_INFORMATION_FORMAT = "dwarf-with-dsym";
        				ENABLE_NS_ASSERTIONS = NO;
        				ENABLE_STRICT_OBJC_MSGSEND = YES;
        				GCC_C_LANGUAGE_STANDARD = gnu11;
        				GCC_NO_COMMON_BLOCKS = YES;
        				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
        				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
        				GCC_WARN_UNDECLARED_SELECTOR = YES;
        				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
        				GCC_WARN_UNUSED_FUNCTION = YES;
        				GCC_WARN_UNUSED_VARIABLE = YES;
        				IPHONEOS_DEPLOYMENT_TARGET = 14.0;
        				MTL_ENABLE_DEBUG_INFO = NO;
        				MTL_FAST_MATH = YES;
        				SDKROOT = iphoneos;
        				SWIFT_COMPILATION_MODE = wholemodule;
        				SWIFT_OPTIMIZATION_LEVEL = "-O";
        				VALIDATE_PRODUCT = YES;
        			};
        			name = Release;
        		};
        	};
        	rootObject = 048A1AAB2A5E4F2D004B1234 /* Project object */;
        }
        EOF
        
        echo "✅ Xcode project created!"
        ls -la MockApp.xcodeproj/
    
    - name: Build for Simulator
      run: |
        cd mock-ios-project
        echo "🏗️ Building for iOS Simulator..."
        xcodebuild \
          -project MockApp.xcodeproj \
          -scheme MockApp \
          -configuration Debug \
          -destination 'platform=iOS Simulator,name=iPhone 14,OS=latest' \
          build \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO
    
    - name: Test Build Results
      run: |
        cd mock-ios-project
        echo "📊 Build Results:"
        ls -la build/ || echo "Build directory not found"
        echo ""
        echo "✅ iOS build completed successfully!"
    
    - name: Create Build Artifacts
      run: |
        mkdir -p build-output
        echo "iOS Build completed at $(date)" > build-output/build-result.txt
        echo "Xcode Version: $(xcrun xcodebuild -version | head -1)" >> build-output/build-result.txt
        echo "Build Configuration: Debug" >> build-output/build-result.txt
        echo "Target Platform: iOS Simulator" >> build-output/build-result.txt
        
        # Copy any build artifacts if they exist
        if [ -d "mock-ios-project/build" ]; then
          cp -r mock-ios-project/build/* build-output/ 2>/dev/null || true
        fi
    
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ios-build-artifacts
        path: build-output/
        retention-days: 7
